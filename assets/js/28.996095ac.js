(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{407:function(s,n,a){"use strict";a.r(n);var e=a(8),r=Object(e.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"容器部署方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#容器部署方式"}},[s._v("#")]),s._v(" 容器部署方式")]),s._v(" "),n("p",[s._v("对于熟悉 Docker 的开发者来说，使用 Docker 部署管理更加的简单高效")]),s._v(" "),n("p",[s._v("我一般习惯将 home 目录作为工作目录，因此 Docker 挂载的文件也都会存放在 home 目录中")]),s._v(" "),n("h3",{attrs:{id:"安装docker"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装docker"}},[s._v("#")]),s._v(" 安装Docker")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun && systemctl start docker && systemctl enable docker\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("如果你机器是国内的机器，那么需要配置镜像加速，一般使用阿里云镜像加速 "),n("a",{attrs:{href:"https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors",target:"_blank",rel:"noopener noreferrer"}},[s._v("阿里云加速官网"),n("OutboundLink")],1)]),s._v(" "),n("p",[n("img",{attrs:{src:"https://eladmin.vip/images/2020/09/17/imageb817a495226b07de.jpg",alt:"imageb817a495226b07de.jpg"}})]),s._v(" "),n("h3",{attrs:{id:"安装mysql与redis"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装mysql与redis"}},[s._v("#")]),s._v(" 安装Mysql与Redis")]),s._v(" "),n("p",[s._v("这里使用的是 mariadb 镜像，并且将 mariadb 数据库文件挂载到宿主机的 "),n("code",[s._v("/home/mysql/")]),s._v(" 目录下")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker run -v /home/mysql/:/var/lib/mysql \\\n-p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 \\\n--privileged=true --restart=always --name mariadb -d mariadb\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("安装Redis")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker run -itd --name redis --restart=always -p 6379:6379 redis\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"构建与启动java容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#构建与启动java容器"}},[s._v("#")]),s._v(" 构建与启动Java容器")]),s._v(" "),n("h4",{attrs:{id:"构建镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#构建镜像"}},[s._v("#")]),s._v(" 构建镜像")]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),n("p",[s._v("Docker 部署使用到了环境变量参数，对于非 "),n("code",[s._v("V2.6")]),s._v(" 版本的，需要修改 application.yml、application-prod.yml 等配置")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/elunez/eladmin/commit/029a932ff96e282f316809af30a176764eafde43",target:"_blank",rel:"noopener noreferrer"}},[s._v("具体参考"),n("OutboundLink")],1)])]),s._v(" "),n("p",[s._v("修改完成后，打包项目将打包好地Jar上传到服务器的 "),n("code",[s._v("/home/eladmin")]),s._v(" 目录，在该目录创建 Dockerfile 文件，并编写 Dockerfile")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('FROM java:8\nARG JAR_FILE=./*.jar\nCOPY ${JAR_FILE} app.jar\nENV TZ=Asia/Shanghai\nENTRYPOINT ["java","-jar","/app.jar"]\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("构建镜像")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker build -t eladmin .\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h4",{attrs:{id:"启动java容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#启动java容器"}},[s._v("#")]),s._v(" 启动Java容器")]),s._v(" "),n("p",[s._v("将容器中的 "),n("code",[s._v("/home/eladmin/")]),s._v(" 挂载到宿主机的 "),n("code",[s._v("/home/data/")]),s._v(" 目录并且设置数据库地址与密码等环境变量参数")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('docker run -d \\\n--name eladmin --restart always \\\n-p 8000:8000 \\\n-e "TZ=Asia/Shanghai" \\\n-e DB_HOST=172.17.0.1 \\\n-e DB_PWD=mysql_pwd \\\n-e REDIS_HOST=172.17.0.1 \\\n-v /home/data/:/home/eladmin/ \\\neladmin\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h3",{attrs:{id:"安装与配置nginx容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装与配置nginx容器"}},[s._v("#")]),s._v(" 安装与配置Nginx容器")]),s._v(" "),n("h4",{attrs:{id:"安装nginx"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装nginx"}},[s._v("#")]),s._v(" 安装Nginx")]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),n("ul",[n("li",[s._v("/home/nginx/conf.d 用于存放配置文件")]),s._v(" "),n("li",[s._v("/home/nginx/cert 用于存放 https 证书")]),s._v(" "),n("li",[s._v("/home/nginx/html 用于存放网页文件")]),s._v(" "),n("li",[s._v("/home/nginx/logs 用于存放日志")])])]),s._v(" "),n("p",[s._v("首先在 "),n("code",[s._v("/home/nginx")]),s._v(" 目录创建 nginx.conf 文件，不然安装 Nginx 会报错")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('user  nginx;\nworker_processes  1;\n\nerror_log  /var/log/nginx/error.log warn;\npid        /var/run/nginx.pid;\n\n\nevents {\n    worker_connections  1024;\n}\n\n\nhttp {\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n\n    log_format  main  \'$remote_addr - $remote_user [$time_local] "$request" \'\n                      \'$status $body_bytes_sent "$http_referer" \'\n                      \'"$http_user_agent" "$http_x_forwarded_for"\';\n\n#    access_log  /var/log/nginx/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    keepalive_timeout  65;\n\n    include /etc/nginx/conf.d/*.conf;\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("p",[s._v("然后安装 Nginx")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('docker run -d \\\n--name nginx --restart always \\\n-p 80:80 -p 443:443 \\\n-e "TZ=Asia/Shanghai" \\\n-v /home/nginx/nginx.conf:/etc/nginx/nginx.conf \\\n-v /home/nginx/conf.d:/etc/nginx/conf.d \\\n-v /home/nginx/logs:/var/log/nginx \\\n-v /home/nginx/cert:/etc/nginx/cert \\\n-v /home/nginx/html:/usr/share/nginx/html \\\nnginx:alpine\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h4",{attrs:{id:"配置nginx"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置nginx"}},[s._v("#")]),s._v(" 配置Nginx")]),s._v(" "),n("p",[s._v("这里使用 Nginx 反向代理访问后端服务，由于容器内部通信，因此需要使用容器的 IP，也就是 172.17.0.1")]),s._v(" "),n("p",[s._v("在 "),n("code",[s._v("/home/nginx/conf.d")]),s._v(" 创建一个 eladmin.conf 的配置文件，文件内容如下")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('server\n    {\n        listen 80;\n        server_name 域名/外网IP;\n        index index.html;\n        root  /usr/share/nginx/html/eladmin/dist;  #dist上传的路径\n\n        # 避免访问出现 404 错误\n        location / {\n          try_files $uri $uri/ @router;\n          index  index.html;\n        }\n\n        location @router {\n          rewrite ^.*$ /index.html last;\n        }\n\n        # 接口\n        location /api {\n          proxy_pass http://172.17.0.1:8000;\n          proxy_set_header X-Forwarded-Proto $scheme;\n          proxy_set_header X-Forwarded-Port $server_port;\n          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n          proxy_set_header Upgrade $http_upgrade;\n          proxy_set_header Connection "upgrade";\n        }\n\n        # 授权接口\n        location /auth {\n          proxy_pass http://172.17.0.1:8000;\n          proxy_set_header X-Forwarded-Proto $scheme;\n          proxy_set_header X-Forwarded-Port $server_port;\n          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n          proxy_set_header Upgrade $http_upgrade;\n          proxy_set_header Connection "upgrade";\n        }\n\n        # WebSocket 服务\n        location /webSocket {\n          proxy_redirect off;\n          proxy_pass http://172.17.0.1:8000/webSocket;\n          proxy_http_version 1.1;\n          proxy_set_header Upgrade $http_upgrade;\n          proxy_set_header Connection "upgrade";\n          proxy_set_header Host $http_host;\n          proxy_set_header X-Real-IP $remote_addr;\n          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n          proxy_connect_timeout 60s;\n          proxy_read_timeout 86400s;\n          proxy_send_timeout 60s;\n        }\n\n        # 头像\n        location /avatar {\n          proxy_pass http://172.17.0.1:8000;\n        }\n\n        # 文件\n        location /file {\n          proxy_pass http://172.17.0.1:8000;\n        }\n    }\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br")])]),n("p",[s._v("注意：容器中 "),n("code",[s._v("/usr/share/nginx/html/eladmin/dist")]),s._v(" 对应宿主机的 "),n("code",[s._v("/home/nginx/html/eladmin/dist")]),s._v(" 目录，因此文件上传到宿主机的目录即可")]),s._v(" "),n("h3",{attrs:{id:"打包上传前端代码【重要】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#打包上传前端代码【重要】"}},[s._v("#")]),s._v(" 打包上传前端代码【重要】")]),s._v(" "),n("p",[s._v("由于Nginx使用的是反向代理后端接口，因此 非 V2.6 版本需要做如下修改")]),s._v(" "),n("p",[s._v("1、将 "),n("code",[s._v(".env.production")]),s._v(" 中的接口地址改为 "),n("code",[s._v("'/'")])]),s._v(" "),n("p",[n("img",{attrs:{src:"https://eladmin.vip/images/2020/09/17/imageb0806c848d01318e.jpg",alt:"imageb0806c848d01318e.jpg"}})]),s._v(" "),n("p",[s._v("2、修改 "),n("code",[s._v("api.js")]),s._v(" 中的 "),n("code",[s._v("baseUrl = process.env.VUE_APP_BASE_API === '/' ? '' : process.env.VUE_APP_BASE_API")])]),s._v(" "),n("p",[n("img",{attrs:{src:"https://eladmin.vip/images/2020/09/17/imagedcd151a815c62932.jpg",alt:"imagedcd151a815c62932.jpg"}})]),s._v(" "),n("p",[s._v("3、打包项目并且上传到 "),n("code",[s._v("/home/nginx/html/eladmin")]),s._v(" 目录下")]),s._v(" "),n("p",[s._v("4、重启 Nginx 容器 "),n("code",[s._v("docker restart nginx")])]),s._v(" "),n("Vssue",{attrs:{title:s.$title}})],1)}),[],!1,null,null,null);n.default=r.exports}}]);